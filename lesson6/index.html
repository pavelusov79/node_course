<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Index</title>
		<script src="https://cdn.socket.io/3.1.1/socket.io.min.js" integrity="sha384-gDaozqUvc4HTgo8iZjwth73C6dDDeOJsAgpxBcMpZYztUfjHXpzrpdrHRdVp8ySO" crossorigin="anonymous"></script>
	</head>
	<body>
		<h1>Index page</h1><br>
		<h4 style="margin: 10px, 0;" id="client"></h4>
		<input type="text" id="input" autofocus>
		<input type="submit" id="send" value="Send">
		<div style="margin-top: 20px;" id="messages"></div>
	</body>
	<script type="text/javascript">
		const socket = io('127.0.0.1:3000');
		// const clientName = Math.floor(Math.random() * 100);
		
		const addMessage = (msg) => {
			const msgSpan = document.createElement('span').innerHTML = msg;
			document.getElementById('messages').append(msgSpan);
			document.getElementById('messages').append(document.createElement('br'));
		};

		// socket.emit('client_on', document.getElementById('client').innerHTML = `Connection starts. User - ${clientName}`);
		socket.on('client_on', data => document.getElementById('client').innerHTML += data.msg +'<br>');

		window.onbeforeunload = function() {
			socket.on('disconnect_client', data => {
				document.getElementById('client').innerHTML += data.msg +'<br>';
			});
		}
		
		socket.on('SERVER_MSG', function (data) {
			addMessage(data.msg);
		});
		document.getElementById('send').onclick = function() {
			socket.emit('CLIENT_MSG', { msg: document.getElementById('input').value});
			document.getElementById('input').value = '';
		};
	</script>
</html>